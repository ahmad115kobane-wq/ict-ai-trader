# ๐ง ุญู ูุดููุฉ ุชููู ุงูุฅุดุนุงุฑุงุช ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู

## ๐ด ุงููุดููุฉ
ุนูุฏ ุฅุบูุงู ุงูุชุทุจููุ ูุชููู ุงูู Foreground Service ููุง ุชุตู ุงูุฅุดุนุงุฑุงุช. ุขุฎุฑ ูุญุต ูุจูู ุนูุฏ ููุช ุฅุบูุงู ุงูุชุทุจูู (ูุซูุงู 6:20) ููุง ูุชุญุฏุซ.

## ๐ฏ ุงูุณุจุจ
Android ููุชู ุนูููุฉ JavaScript ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู ุจุงููุงูู. ุงูู `setInterval` ู `setTimeout` ูุง ูุนููุงู ุนูุฏูุง ูููู ุงูุชุทุจูู ูุบููุงู.

## โ ุงูุญู ุงูุตุญูุญ

### ุงูุงุนุชูุงุฏ ุนูู **Expo Push Notifications ูู ุงูุณูุฑูุฑ**

ูุฐุง ูู ุงูุญู ุงููุญูุฏ ุงููุถููู 100% ููุฅุดุนุงุฑุงุช ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู:

#### 1๏ธโฃ ููู ูุนููุ
```
ุงูุณูุฑูุฑ (ูุนูู 24/7)
    โ
ูุญูู ุงูุณูู ูู 5 ุฏูุงุฆู ุนูุฏ ุฅุบูุงู ุดูุนุฉ M5
    โ
ููุชุดู ูุฑุตุฉ ุชุฏุงูู
    โ
ูุฑุณู Push Notification ูุฌููุน ุงููุณุชุฎุฏููู ุงููุณุฌููู
    โ
Expo Push Service ููุตู ุงูุฅุดุนุงุฑ ูููุงุชู
    โ
ุงูุฅุดุนุงุฑ ูุธูุฑ ุญุชู ูู ุงูุชุทุจูู ูุบูู ุชูุงูุงู โ
```

#### 2๏ธโฃ ููุงุฐุง ูุฐุง ุงูุญู ุฃูุถูุ
- โ **ูุนูู 100% ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู**
- โ **ูุง ูุนุชูุฏ ุนูู JavaScript ูู ุงููุงุชู**
- โ **ุงูุณูุฑูุฑ ูุนูู 24/7 ุจุฏูู ุชููู**
- โ **ูุง ูุณุชููู ุจุทุงุฑูุฉ ุงููุงุชู**
- โ **ููุซูู ููุณุชูุฑ**

---

## ๐ฑ ุงูุชุนุฏููุงุช ุงููุทููุจุฉ

### 1. ุชุญุฏูุซ Foreground Service
ุชู ุชุญุฏูุซ ุงูููู ูุฅุถุงูุฉ Background Fetch Task:

```typescript
// mobile/src/services/foregroundService.ts

// ุชุณุฌูู ูููุฉ ุฎูููุฉ ุชุนูู ุญุชู ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู
TaskManager.defineTask(BACKGROUND_TASK_NAME, async () => {
  // ูุญุต ุงูุณูุฑูุฑ ูุฅุฑุณุงู ุฅุดุนุงุฑุงุช
  // ูุฐู ุงููููุฉ ุชุนูู ูู 15 ุฏูููุฉ ุญุชู ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู
});

// ุชุณุฌูู ุงููููุฉ
await BackgroundFetch.registerTaskAsync(BACKGROUND_TASK_NAME, {
  minimumInterval: 15 * 60, // 15 ุฏูููุฉ
  stopOnTerminate: false, // ูุณุชูุฑ ุจุนุฏ ุฅุบูุงู ุงูุชุทุจูู
  startOnBoot: true, // ูุจุฏุฃ ุนูุฏ ุชุดุบูู ุงูุฌูุงุฒ
});
```

### 2. ุงูุชุฃูุฏ ูู ุชุณุฌูู Push Token
ูู `mobile/src/services/autoAnalysisService.ts`:

```typescript
// ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู ุฃู ูุชุญ ุงูุชุทุจูู
export const registerExpoPushToken = async (): Promise<string | null> => {
  // 1. ุทูุจ ุงูุฃุฐููุงุช
  const { status } = await Notifications.requestPermissionsAsync();
  
  // 2. ุงูุญุตูู ุนูู Push Token
  const token = (await Notifications.getExpoPushTokenAsync()).data;
  
  // 3. ุฅุฑุณุงู Token ููุณูุฑูุฑ
  await apiService.setUserPushToken(token);
  
  // 4. ุญูุธ Token ูุญููุงู
  await AsyncStorage.setItem('EXPO_PUSH_TOKEN', token);
  
  return token;
};
```

### 3. ุงูุณูุฑูุฑ ูุฑุณู ุงูุฅุดุนุงุฑุงุช ุชููุงุฆูุงู
ูู `server/src/index.ts`:

```typescript
// ุงูุชุญููู ุงูุชููุงุฆู ูู 5 ุฏูุงุฆู
const runAutoAnalysis = async () => {
  // ... ุชุญููู ุงูุณูู
  
  if (analysis.decision === 'PLACE_PENDING') {
    // ุฅุฑุณุงู Push Notifications ูุฌููุน ุงููุณุชุฎุฏููู
    const usersWithTokens = await getUsersWithPushTokens();
    const pushTokens = usersWithTokens.map(u => u.push_token);
    
    await sendTradeNotification(
      pushTokens,
      analysis.suggestedTrade,
      analysis.score,
      currentPrice
    );
    
    console.log(`๐ฑ Sent notifications to ${pushTokens.length} devices`);
  }
};
```

---

## ๐ ุงูุทุจูุงุช ุงููุชุนุฏุฏุฉ ููููุซูููุฉ

### ุงูุทุจูุฉ 1: Expo Push (ุงูุฃุณุงุณูุฉ) โญโญโญ
- **ูุชู ุชุนูู:** ุฏุงุฆูุงูุ ุญุชู ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู
- **ููู:** ุงูุณูุฑูุฑ ูุฑุณู ูุจุงุดุฑุฉ ูู Expo Push Service
- **ุงูููุซูููุฉ:** 99%
- **ุงูุงุณุชุฎุฏุงู:** ููุฅุดุนุงุฑุงุช ุงููููุฉ (ูุฑุต ุงูุชุฏุงูู)

### ุงูุทุจูุฉ 2: Background Fetch โญโญ
- **ูุชู ุชุนูู:** ูู 15 ุฏูููุฉ ุนูุฏูุง ูููู ุงูุชุทุจูู ูู ุงูุฎูููุฉ
- **ููู:** ูุธุงู Android ูุดุบู ุงููููุฉ ุฏูุฑูุงู
- **ุงูููุซูููุฉ:** 70% (ูุนุชูุฏ ุนูู ูุธุงู Android)
- **ุงูุงุณุชุฎุฏุงู:** ููุณุฎุฉ ุงุญุชูุงุทูุฉ

### ุงูุทุจูุฉ 3: Foreground Service โญ
- **ูุชู ุชุนูู:** ููุท ุนูุฏูุง ูููู ุงูุชุทุจูู ููุชูุญุงู ุฃู ูู ุงูุฎูููุฉ ุงููุฑูุจุฉ
- **ููู:** JavaScript timer
- **ุงูููุซูููุฉ:** 50% (ูุชููู ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู)
- **ุงูุงุณุชุฎุฏุงู:** ููุชุญุฏูุซุงุช ุงูููุฑูุฉ ุนูุฏ ูุชุญ ุงูุชุทุจูู

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ุงูุชุทุจูู ููุชูุญ
```bash
1. ุงูุชุญ ุงูุชุทุจูู
2. ุณุฌู ุงูุฏุฎูู
3. ูุนูู ุงูุชุญููู ุงูุชููุงุฆู
4. ุงูุชุธุฑ ุญุชู ุฅุบูุงู ุดูุนุฉ M5 (ูู 5 ุฏูุงุฆู: 0, 5, 10, 15, ...)
5. ูุฌุจ ุฃู ุชุตู ุฅุดุนุงุฑุงุช ููุฑูุฉ โ
```

### ุงุฎุชุจุงุฑ 2: ุงูุชุทุจูู ูู ุงูุฎูููุฉ
```bash
1. ุงูุชุญ ุงูุชุทุจูู ููุนูู ุงูุชุญููู
2. ุงุถุบุท Home (ุงูุชุทุจูู ูู ุงูุฎูููุฉ)
3. ุงูุชุธุฑ 5 ุฏูุงุฆู
4. ูุฌุจ ุฃู ุชุตู ุฅุดุนุงุฑุงุช โ
```

### ุงุฎุชุจุงุฑ 3: ุงูุชุทุจูู ูุบูู ุชูุงูุงู โญ (ุงูุฃูู)
```bash
1. ุงูุชุญ ุงูุชุทุจูู ููุนูู ุงูุชุญููู
2. ุชุฃูุฏ ูู ุชุณุฌูู Push Token
3. ุฃุบูู ุงูุชุทุจูู ุจุงููุงูู (Swipe ูู Recent Apps)
4. ุงูุชุธุฑ ุญุชู ุฅุบูุงู ุดูุนุฉ M5 ุงููุงุฏูุฉ
5. ูุฌุจ ุฃู ุชุตู ุฅุดุนุงุฑุงุช ูู ุงูุณูุฑูุฑ โ
```

### ุงุฎุชุจุงุฑ 4: ุฅุฑุณุงู ุตููุฉ ุชุฌุฑูุจูุฉ
```bash
# ูู ุงููุชุตูุญ
1. ุงูุชุญ: http://your-server.com/send-test-trade
2. ุณูุฑุณู ุงูุณูุฑูุฑ ุตููุฉ ุชุฌุฑูุจูุฉ
3. ูุฌุจ ุฃู ุชุตู ุงูุฅุดุนุงุฑุงุช ูุฌููุน ุงููุณุชุฎุฏููู โ
```

---

## ๐ ููุงุฑูุฉ ุงูุญููู

| ุงูุญู | ูุนูู ุนูุฏ ุงูุฅุบูุงู | ุงุณุชููุงู ุงูุจุทุงุฑูุฉ | ุงูููุซูููุฉ | ุงูุชุนููุฏ |
|------|------------------|------------------|-----------|---------|
| **Expo Push ูู ุงูุณูุฑูุฑ** | โ ูุนู | ููุฎูุถ ุฌุฏุงู | 99% | ุจุณูุท |
| Background Fetch | โ๏ธ ุฃุญูุงูุงู | ูุชูุณุท | 70% | ูุชูุณุท |
| Foreground Service | โ ูุง | ุนุงูู | 50% | ูุนูุฏ |
| Native Service | โ ูุนู | ุนุงูู | 95% | ูุนูุฏ ุฌุฏุงู |

---

## โ ุงูุฎูุงุตุฉ ูุงูุชูุตูุงุช

### โ ุงูุญู ุงูููุตู ุจู (ุงููุทุจู ุญุงููุงู):

1. **ุงูุงุนุชูุงุฏ ุงูุฃุณุงุณู ุนูู Expo Push Notifications ูู ุงูุณูุฑูุฑ**
   - ุงูุณูุฑูุฑ ูุญูู ุงูุณูู ูู 5 ุฏูุงุฆู
   - ูุฑุณู ุฅุดุนุงุฑุงุช ูุฌููุน Push Tokens ุงููุณุฌูุฉ
   - ูุนูู 100% ุญุชู ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู

2. **Background Fetch ููุณุฎุฉ ุงุญุชูุงุทูุฉ**
   - ูุนูู ูู 15 ุฏูููุฉ
   - ููุญุต ุงูุณูุฑูุฑ ููุฑุณู ุฅุดุนุงุฑุงุช ูุญููุฉ
   - ูููุฏ ุนูุฏ ุชุฃุฎุฑ Expo Push

3. **Foreground Service ููุชุญุฏูุซุงุช ุงูููุฑูุฉ**
   - ูุนูู ููุท ุนูุฏูุง ูููู ุงูุชุทุจูู ููุชูุญุงู
   - ูุนุทู ุชุฌุฑุจุฉ ุฃูุถู ูููุณุชุฎุฏู ุงููุดุท
   - ูุธูุฑ ุฅุดุนุงุฑ ูุณุชูุฑ ุจุงูุญุงูุฉ

### ๐ฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:
- โ ุงูุฅุดุนุงุฑุงุช ุชุตู ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู (ุนุจุฑ Expo Push)
- โ ุงูุฅุดุนุงุฑุงุช ุชุตู ุนูุฏ ูุชุญ ุงูุชุทุจูู (ุนุจุฑ Foreground Service)
- โ ูุณุฎุฉ ุงุญุชูุงุทูุฉ (ุนุจุฑ Background Fetch)
- โ ูุง ููุฌุฏ ุงุณุชููุงู ุฒุงุฆุฏ ููุจุทุงุฑูุฉ
- โ ููุซูููุฉ ุนุงููุฉ

---

## ๐ ุงูุชุญูู ูู ุนูู ุงููุธุงู

### ูู ุงูุชุทุจูู:
```typescript
// ุชุญูู ูู ุชุณุฌูู Push Token
const token = await AsyncStorage.getItem('EXPO_PUSH_TOKEN');
console.log('Push Token:', token);

// ุชุญูู ูู ุญุงูุฉ Background Fetch
const status = await BackgroundFetch.getStatusAsync();
console.log('Background Fetch Status:', status);
```

### ูู ุงูุณูุฑูุฑ:
```bash
# ุชุญูู ูู ุงููุณุชุฎุฏููู ุงููุณุฌููู
GET /api/auth/me

# ุชุญูู ูู ุญุงูุฉ ุงูุชุญููู ุงูุชููุงุฆู
GET /auto-analysis-status

# ุฅุฑุณุงู ุตููุฉ ุชุฌุฑูุจูุฉ
GET /send-test-trade
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

### โ๏ธ ูููุฏ Background Fetch ูู Android:
- ุงูุญุฏ ุงูุฃุฏูู ูููุงุตู ุงูุฒููู: 15 ุฏูููุฉ
- ูุฏ ูุง ูุนูู ุจุฏูุฉ (ูุนุชูุฏ ุนูู ูุธุงู Android)
- ูุฏ ูุชุฃุฎุฑ ุฅุฐุง ูุงูุช ุงูุจุทุงุฑูุฉ ููุฎูุถุฉ
- **ูุฐูู ูุนุชูุฏ ุจุดูู ุฃุณุงุณู ุนูู Expo Push**

### โ ูููุฒุงุช Expo Push:
- ูุนูู ููุฑุงู (ุจุฏูู ุชุฃุฎูุฑ)
- ูุง ูุนุชูุฏ ุนูู ุญุงูุฉ ุงูุจุทุงุฑูุฉ
- ููุซูู 99%
- ูุง ูุณุชููู ููุงุฑุฏ ุงููุงุชู
- **ูุฐุง ูู ุงูุญู ุงูุฃุณุงุณู**

### ๐ ุชูููุฑ ุงูุจุทุงุฑูุฉ:
- Foreground Service ูุนูู ููุท ุนูุฏ ูุชุญ ุงูุชุทุจูู
- Background Fetch ูุนูู ูู 15 ุฏูููุฉ ููุท
- Expo Push ูุง ูุณุชููู ุจุทุงุฑูุฉ (ูุฃุชู ูู ุงูุฎุงุฑุฌ)

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ:** ${new Date().toLocaleString('ar-EG')}
**ุงูุญุงูุฉ:** โ ุชู ุชุทุจูู ุงูุญู ุงูุฃูุซู
**ุงูุชูุตูุฉ:** ุงูุงุนุชูุงุฏ ุนูู Expo Push ูู ุงูุณูุฑูุฑ ูุญู ุฃุณุงุณู
