# ุฅุตูุงุญ ูุดููุฉ ุฃุฒุฑุงุฑ Telegram Bot

## ุงููุดููุฉ
ุงููุณุชุฎุฏู ูุชููู ุฅุดุนุงุฑุงุช Telegram ููู ุงูุฃุฒุฑุงุฑ ูุง ุชุณุชุฌูุจ ุนูุฏ ุงูุถุบุท ุนูููุง.

## ุงูุชุดุฎูุต
ุจุนุฏ ูุญุต ุงูููุฏุ ูุฌุฏูุง ุฃู:
- โ Webhook endpoint ููุฌูุฏ: `/api/telegram/webhook`
- โ ูุนุงูุฌ ุงูุฃุฒุฑุงุฑ ููุฌูุฏ ูู `telegramBotService.ts`
- โ Webhook ูุชู ุชูุนููู ุชููุงุฆูุงู ุนูุฏ ุจุฏุก ุงูุฎุงุฏู
- โ๏ธ ุงููุดููุฉ: ูุฏ ูููู Webhook ุบูุฑ ูููุนู ุจุดูู ุตุญูุญ ุฃู TELEGRAM_BOT_TOKEN ุบูุฑ ูุญุฏุฏ

## ุงูุญู ุงููุทุจู

### 1. ุชุญุณูู ุงูุณุฌูุงุช (Logging)
ุฃุถููุง ุณุฌูุงุช ุชูุตูููุฉ ูุชุชุจุน ูุดุงุท Webhook:
- ุชุณุฌูู ูู ุชุญุฏูุซ ูุตู ูู Telegram
- ุชุณุฌูู ููุน ุงูุชุญุฏูุซ (ุฑุณุงูุฉ ุฃู ุถุบุทุฉ ุฒุฑ)
- ุชุณุฌูู ูุนุฑู ุงููุณุชุฎุฏู ูุงูุจูุงูุงุช ุงููุฑุณูุฉ

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `server/src/routes/telegram.ts` - ุฅุถุงูุฉ ุณุฌูุงุช ูู webhook endpoint
- `server/src/services/telegramBotService.ts` - ุฅุถุงูุฉ ุณุฌูุงุช ูู ูุนุงูุฌ ุงูุฃุฒุฑุงุฑ

### 2. ุฅุถุงูุฉ ุฃุฒุฑุงุฑ ุงุฎุชุจุงุฑ
ุฃุถููุง ูุนุงูุฌุงุช ูุฃุฒุฑุงุฑ ุงุฎุชุจุงุฑ ุฎุงุตุฉ:
- `test_button_1` - ุฒุฑ ุงุฎุชุจุงุฑ 1
- `test_button_2` - ุฒุฑ ุงุฎุชุจุงุฑ 2

### 3. ุฅูุดุงุก ุตูุญุฉ ุชุดุฎูุต
ุฃูุดุฃูุง ุตูุญุฉ HTML ุดุงููุฉ ูุชุดุฎูุต ูุงุฎุชุจุงุฑ Webhook:

**ุงูุฑุงุจุท:** `https://ict-ai-trader-production.up.railway.app/test-telegram-webhook`

**ุงูููุฒุงุช:**
- โ ูุญุต ุญุงูุฉ Webhook ุงูุญุงููุฉ
- โ ุฅุนุงุฏุฉ ุชูุนูู Webhook ูุฏููุงู
- โ ุฅุฑุณุงู ุฑุณุงูุฉ ุงุฎุชุจุงุฑ ูุน ุฃุฒุฑุงุฑ
- โ ุนุฑุถ ูุนูููุงุช ุชูุตูููุฉ ุนู ุงูุชูููู

### 4. ุฅุถุงูุฉ endpoints ุฌุฏูุฏุฉ

#### GET `/api/telegram/webhook-info`
ูุนุฑุถ ูุนูููุงุช ุชูุตูููุฉ ุนู ุญุงูุฉ Webhook:
```json
{
  "success": true,
  "info": {
    "url": "https://...",
    "has_custom_certificate": false,
    "pending_update_count": 0
  },
  "status": "โ Webhook configured",
  "pendingUpdates": 0
}
```

#### GET `/api/telegram/test-webhook`
ูุฑุณู ุฑุณุงูุฉ ุงุฎุชุจุงุฑ ูุน ุฃุฒุฑุงุฑ ุฅูู Telegram:
- ูุชุทูุจ `TELEGRAM_BOT_TOKEN` ู `TELEGRAM_CHAT_ID` ูู ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ
- ูุฑุณู ุฑุณุงูุฉ ูุน 3 ุฃุฒุฑุงุฑ ููุงุฎุชุจุงุฑ

#### POST `/api/telegram/setup-webhook`
ูุนูุฏ ุชูุนูู Webhook ูุฏููุงู:
```json
{
  "webhookUrl": "https://ict-ai-trader-production.up.railway.app/api/telegram/webhook"
}
```

## ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ

### ุงูุทุฑููุฉ 1: ุงุณุชุฎุฏุงู ุตูุญุฉ ุงูุชุดุฎูุต (ููุตู ุจูุง)

1. ุงูุชุญ ุงูุฑุงุจุท:
   ```
   https://ict-ai-trader-production.up.railway.app/test-telegram-webhook
   ```

2. ุงุถุบุท ุนูู "ูุญุต ุญุงูุฉ Webhook"
   - ุฅุฐุง ูุงู ุงูู URL ูุงุฑุบุงู ุฃู ุบูุฑ ุตุญูุญุ ุงุถุบุท ุนูู "ุฅุนุงุฏุฉ ุชูุนูู Webhook"

3. ุงุถุบุท ุนูู "ุฅุฑุณุงู ุฑุณุงูุฉ ุงุฎุชุจุงุฑ"
   - ุงูุชุญ Telegram
   - ุณุชุตูู ุฑุณุงูุฉ ูุน 3 ุฃุฒุฑุงุฑ
   - ุงุถุบุท ุนูู ุงูุฃุฒุฑุงุฑ

4. ุฑุงูุจ ุณุฌูุงุช ุงูุฎุงุฏู:
   - ุฅุฐุง ุฑุฃูุช `๐ Button clicked: test_button_1` ูุงูู webhook ูุนูู
   - ุฅุฐุง ูู ุชุธูุฑ ุฃู ุณุฌูุงุชุ ูุงูู webhook ุบูุฑ ูููุนู

### ุงูุทุฑููุฉ 2: ุงุฎุชุจุงุฑ ูุฏูู

1. **ูุญุต ุญุงูุฉ Webhook:**
   ```bash
   curl https://ict-ai-trader-production.up.railway.app/api/telegram/webhook-info
   ```

2. **ุฅุนุงุฏุฉ ุชูุนูู Webhook:**
   ```bash
   curl -X POST https://ict-ai-trader-production.up.railway.app/api/telegram/setup-webhook \
     -H "Content-Type: application/json" \
     -d '{"webhookUrl":"https://ict-ai-trader-production.up.railway.app/api/telegram/webhook"}'
   ```

3. **ุฅุฑุณุงู ุฑุณุงูุฉ ุงุฎุชุจุงุฑ:**
   ```bash
   curl https://ict-ai-trader-production.up.railway.app/api/telegram/test-webhook
   ```

### ุงูุทุฑููุฉ 3: ุงุฎุชุจุงุฑ ูุน ุงูุจูุช ูุจุงุดุฑุฉ

1. ุงูุชุญ Telegram ูุงุจุญุซ ุนู ุงูุจูุช ุงูุฎุงุต ุจู
2. ุฃุฑุณู `/start`
3. ุงุถุบุท ุนูู ุฃู ุฒุฑ (ูุซู "โถ๏ธ ุชูุนูู ุงูุชุญููู ุงูุชููุงุฆู")
4. ุฑุงูุจ ุณุฌูุงุช ุงูุฎุงุฏู

## ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ุงููุทููุจุฉ

ุชุฃูุฏ ูู ุฃู ูุฐู ุงููุชุบูุฑุงุช ูุญุฏุฏุฉ ูู Railway:

```env
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_CHAT_ID=your_chat_id_here  # ุงุฎุชูุงุฑู ููุงุฎุชุจุงุฑ
```

### ููููุฉ ุงูุญุตูู ุนูู TELEGRAM_BOT_TOKEN:
1. ุงุจุญุซ ุนู `@BotFather` ูู Telegram
2. ุฃุฑุณู `/newbot`
3. ุงุชุจุน ุงูุชุนูููุงุช
4. ุงุญุตู ุนูู Token ูุฃุถูู ุฅูู Railway

### ููููุฉ ุงูุญุตูู ุนูู TELEGRAM_CHAT_ID:
1. ุฃุฑุณู ุฑุณุงูุฉ ูุจูุชู
2. ุงูุชุญ: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
3. ุงุจุญุซ ุนู `"chat":{"id":123456789}`
4. ุงุณุชุฎุฏู ูุฐุง ุงูุฑูู ูู CHAT_ID

## ุงูุชุญูู ูู ูุฌุงุญ ุงูุฅุตูุงุญ

### ุนูุงูุงุช ุงููุฌุงุญ:
- โ ุตูุญุฉ `/test-telegram-webhook` ุชุนุฑุถ "โ Webhook configured"
- โ ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ ูู Telegramุ ุชุธูุฑ ุฑุณุงูุฉ ุชุฃููุฏ
- โ ุณุฌูุงุช ุงูุฎุงุฏู ุชุธูุฑ `๐ Button clicked: ...`
- โ ุงูุจูุช ูุณุชุฌูุจ ููุฃูุงูุฑ ูุงูุฃุฒุฑุงุฑ

### ุฅุฐุง ูู ูุนูู:
1. ุชุญูู ูู ุฃู `TELEGRAM_BOT_TOKEN` ูุญุฏุฏ ูู Railway
2. ุชุญูู ูู ุณุฌูุงุช Railway ููุฃุฎุทุงุก
3. ุชุฃูุฏ ูู ุฃู Webhook URL ุตุญูุญ
4. ุฌุฑุจ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู ูู Railway

## ุงููููุงุช ุงููุนุฏูุฉ

1. **server/src/routes/telegram.ts**
   - ุฅุถุงูุฉ ุณุฌูุงุช ุชูุตูููุฉ
   - ุฅุถุงูุฉ endpoint `/test-webhook`
   - ุชุญุณูู endpoint `/webhook-info`

2. **server/src/services/telegramBotService.ts**
   - ุฅุถุงูุฉ ุณุฌูุงุช ูู ูุนุงูุฌ ุงูุฃุฒุฑุงุฑ
   - ุฅุถุงูุฉ ูุนุงูุฌุงุช ูุฃุฒุฑุงุฑ ุงูุงุฎุชุจุงุฑ
   - ุฅุถุงูุฉ ูุนุงูุฌ ููุฃุฒุฑุงุฑ ุบูุฑ ุงููุนุฑููุฉ

3. **server/src/index.ts**
   - ุฅุถุงูุฉ route ูุตูุญุฉ `/test-telegram-webhook`

4. **server/public/test-telegram-webhook.html** (ุฌุฏูุฏ)
   - ุตูุญุฉ ุชุดุฎูุต ูุงุฎุชุจุงุฑ ุดุงููุฉ
   - ูุงุฌูุฉ ูุณุชุฎุฏู ุณููุฉ
   - ุงุฎุชุจุงุฑุงุช ุชููุงุฆูุฉ

## ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. ุงูุชุญ ุตูุญุฉ ุงูุชุดุฎูุต ูุชุญูู ูู ุญุงูุฉ Webhook
2. ุฅุฐุง ูุงู ุบูุฑ ูููุนูุ ุงุถุบุท ุนูู "ุฅุนุงุฏุฉ ุชูุนูู Webhook"
3. ุฃุฑุณู ุฑุณุงูุฉ ุงุฎุชุจุงุฑ ูุงุถุบุท ุนูู ุงูุฃุฒุฑุงุฑ
4. ุฑุงูุจ ุงูุณุฌูุงุช ููุชุฃูุฏ ูู ูุตูู ุงูุชุญุฏูุซุงุช
5. ุฅุฐุง ูุฌุญ ุงูุงุฎุชุจุงุฑุ ุฌุฑุจ ุงูุฃุฒุฑุงุฑ ุงูุญููููุฉ ูู ุงูุจูุช

## ููุงุญุธุงุช ูููุฉ

- Webhook ูุชู ุชูุนููู ุชููุงุฆูุงู ุนูุฏ ุจุฏุก ุงูุฎุงุฏู
- ุฅุฐุง ุชู ุชุบููุฑ `TELEGRAM_BOT_TOKEN`ุ ูุฌุจ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู
- ุงูุณุฌูุงุช ูุชููุฑุฉ ูู Railway Logs
- ูููู ุงุณุชุฎุฏุงู ุตูุญุฉ ุงูุชุดุฎูุต ูู ุฃู ููุช ููุชุญูู ูู ุงูุญุงูุฉ

## ุงูุฏุนู

ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:
1. ุชุญูู ูู ุณุฌูุงุช Railway
2. ุชุฃูุฏ ูู ุตุญุฉ `TELEGRAM_BOT_TOKEN`
3. ุชุญูู ูู ุฃู ุงูุจูุช ูุฏูู ุตูุงุญูุงุช ุงูุฅุฑุณุงู
4. ุฌุฑุจ ุญุฐู Webhook ูุฅุนุงุฏุฉ ุชูุนููู ูู ุตูุญุฉ ุงูุชุดุฎูุต
