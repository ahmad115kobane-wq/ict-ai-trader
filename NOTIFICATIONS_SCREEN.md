# ูุธุงู ุงูุฅุดุนุงุฑุงุช - ุงูุชูู โ

## ุงูููุฎุต
ุชู ุฅูุดุงุก ูุธุงู ุฅุดุนุงุฑุงุช ูุงูู ุฏุงุฎู ุงูุชุทุจูู ูุนุฑุถ 3 ุฃููุงุน ูู ุงูุฅุดุนุงุฑุงุช ููุท:
1. **ุชุฐููุฑ ุจุญุฏุซ ุงูุชุตุงุฏู** (ูุจู 5 ุฏูุงุฆู ูู ุตุฏูุฑ ุงูุฎุจุฑ)
2. **ุชู ุดุฑุงุก ุงุดุชุฑุงู** (ุนูุฏ ุดุฑุงุก ุจุงูุฉ ุฌุฏูุฏุฉ)
3. **ุงูุชูุช ุตูุงุญูุฉ ุงูุงุดุชุฑุงู** (ุนูุฏ ุงูุชูุงุก ุงูุจุงูุฉ)

---

## ูุง ุชู ุฅูุฌุงุฒู

### 1. ุงูุฎุงุฏู (Server)

#### ุฃ. ุฎุฏูุฉ ุงูุฅุดุนุงุฑุงุช (`server/src/services/notificationService.ts`)
- โ ุฅูุดุงุก ุฌุฏูู `notifications` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุฏูุงู ุฅุฏุงุฑุฉ ุงูุฅุดุนุงุฑุงุช:
  - `createNotification()` - ุฅูุดุงุก ุฅุดุนุงุฑ ุฌุฏูุฏ
  - `getUserNotifications()` - ุฌูุจ ุฅุดุนุงุฑุงุช ุงููุณุชุฎุฏู
  - `getUnreadCount()` - ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
  - `markAsRead()` - ุชุนููู ุฅุดุนุงุฑ ูููุฑูุก
  - `markAllAsRead()` - ุชุนููู ุฌููุน ุงูุฅุดุนุงุฑุงุช ูููุฑูุกุฉ
  - `deleteNotification()` - ุญุฐู ุฅุดุนุงุฑ
  - `deleteOldNotifications()` - ุญุฐู ุงูุฅุดุนุงุฑุงุช ุงููุฏููุฉ (ุฃูุซุฑ ูู 30 ููู)
- โ ุฏูุงู ุฅูุดุงุก ุงูุฅุดุนุงุฑุงุช:
  - `createEventReminderNotification()` - ุชุฐููุฑ ุจุญุฏุซ ุงูุชุตุงุฏู
  - `createSubscriptionPurchasedNotification()` - ุฅุดุนุงุฑ ุดุฑุงุก ุงุดุชุฑุงู
  - `createSubscriptionExpiredNotification()` - ุฅุดุนุงุฑ ุงูุชูุงุก ุงุดุชุฑุงู

#### ุจ. ุฎุฏูุฉ ุงูุฅุดุนุงุฑุงุช ุงููุฌุฏููุฉ (`server/src/services/scheduledNotifications.ts`)
- โ **ูุฑุงูุจุฉ ุงูุฃุญุฏุงุซ ุงูุงูุชุตุงุฏูุฉ**:
  - ูุญุต ูู ุฏูููุฉ ููุฃุญุฏุงุซ ุงููุงุฏูุฉ
  - ุฅุฑุณุงู ุชุฐููุฑ ูุจู 5 ุฏูุงุฆู ูู ุตุฏูุฑ ุงูุฎุจุฑ
  - ุชุฌูุจ ุฅุฑุณุงู ููุณ ุงูุฅุดุนุงุฑ ูุฑุชูู
- โ **ูุญุต ุงูุงุดุชุฑุงูุงุช ุงูููุชููุฉ**:
  - ูุญุต ูู ุณุงุนุฉ ููุงุดุชุฑุงูุงุช ุงูููุชููุฉ
  - ุฅุฑุณุงู ุฅุดุนุงุฑ ุนูุฏ ุงูุชูุงุก ุงูุงุดุชุฑุงู
- โ **ุชูุธูู ุงูุฅุดุนุงุฑุงุช ุงููุฏููุฉ**:
  - ุญุฐู ุงูุฅุดุนุงุฑุงุช ุงูุฃูุฏู ูู 30 ููู
  - ูุนูู ููููุงู ูู ุงูุณุงุนุฉ 3 ุตุจุงุญุงู

#### ุฌ. ูุณุงุฑุงุช API (`server/src/routes/notifications.ts`)
- โ `GET /api/notifications` - ุฌูุจ ุฅุดุนุงุฑุงุช ุงููุณุชุฎุฏู
- โ `GET /api/notifications/unread-count` - ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
- โ `POST /api/notifications/:id/read` - ุชุนููู ุฅุดุนุงุฑ ูููุฑูุก
- โ `POST /api/notifications/mark-all-read` - ุชุนููู ุฌููุน ุงูุฅุดุนุงุฑุงุช ูููุฑูุกุฉ
- โ `DELETE /api/notifications/:id` - ุญุฐู ุฅุดุนุงุฑ

#### ุฏ. ุชุญุฏูุซุงุช ุนูู ุงูุฎุงุฏู (`server/src/index.ts`)
- โ ุชุณุฌูู ูุณุงุฑ ุงูุฅุดุนุงุฑุงุช: `app.use('/api/notifications', notificationsRoutes)`
- โ ุชููุฆุฉ ุฌุฏูู ุงูุฅุดุนุงุฑุงุช ุนูุฏ ุจุฏุก ุงูุชุดุบูู: `initNotificationsTable()`
- โ ุจุฏุก ุงูููุงู ุงููุฌุฏููุฉ: `startAllScheduledNotifications()`
- โ ุฅููุงู ุงูููุงู ุนูุฏ ุฅููุงู ุงูุฎุงุฏู: `stopAllScheduledNotifications()`

#### ูู. ุชุญุฏูุซุงุช ุนูู ูุณุงุฑ ุงูุงุดุชุฑุงูุงุช (`server/src/routes/subscription.ts`)
- โ ุฅูุดุงุก ุฅุดุนุงุฑ ุนูุฏ ุดุฑุงุก ุงุดุชุฑุงู ุจูุฌุงุญ
- โ ุชูุฑูุฑ `packageDetails.durationDays` ุจุฏูุงู ูู `result.expiresAt`

---

### 2. ุงูุชุทุจูู (Mobile App)

#### ุฃ. ุดุงุดุฉ ุงูุฅุดุนุงุฑุงุช (`mobile/src/screens/NotificationsScreen.tsx`)
- โ ุชุตููู ูุงูู ูุน:
  - ุจุทุงูุงุช ุฅุดุนุงุฑุงุช ูุน ุฃููููุงุช ูุฃููุงู ุญุณุจ ุงูููุน
  - ููุทุฉ ุฒุฑูุงุก ููุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
  - ุฒุฑ "ุชุนููู ุงููู ูููุฑูุก"
  - ุฒุฑ ุญุฐู ููู ุฅุดุนุงุฑ
  - Pull-to-refresh
  - ุดุงุดุฉ ูุงุฑุบุฉ ุนูุฏ ุนุฏู ูุฌูุฏ ุฅุดุนุงุฑุงุช
- โ ุฑุจุท ูุน API:
  - ุฌูุจ ุงูุฅุดุนุงุฑุงุช ูู ุงูุฎุงุฏู
  - ุชุนููู ูููุฑูุก
  - ุญุฐู ุฅุดุนุงุฑ
  - ุนุฑุถ ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ

#### ุจ. ูููู ุงูููุฏุฑ (`mobile/src/components/Header.tsx`)
- โ ุฃููููุฉ ุงูุฅุดุนุงุฑุงุช ูุน badge ูุนุฑุถ ุงูุนุฏุฏ
- โ ูุฏุนู `unreadCount` prop
- โ ุงูุชููู ุฅูู ุดุงุดุฉ ุงูุฅุดุนุงุฑุงุช ุนูุฏ ุงูุถุบุท

#### ุฌ. ุฎุฏูุฉ API (`mobile/src/services/apiService.ts`)
- โ ุฅุถุงูุฉ `notificationService` ูุน ุฌููุน ุงูุฏูุงู:
  - `getNotifications()` - ุฌูุจ ุงูุฅุดุนุงุฑุงุช
  - `getUnreadCount()` - ุนุฏุฏ ุบูุฑ ุงูููุฑูุกุฉ
  - `markAsRead()` - ุชุนููู ูููุฑูุก
  - `markAllAsRead()` - ุชุนููู ุงููู ูููุฑูุก
  - `deleteNotification()` - ุญุฐู ุฅุดุนุงุฑ

#### ุฏ. ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ (`mobile/src/screens/HomeScreen.tsx`)
- โ ุฌูุจ ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
- โ ุชูุฑูุฑ `unreadCount` ุฅูู Header
- โ ุชุญุฏูุซ ุงูุนุฏุฏ ุนูุฏ refresh

#### ูู. ุงูุชููู (`mobile/src/navigation/AppNavigator.tsx`)
- โ ุฅุถุงูุฉ ูุณุงุฑ `Notifications` (ุชู ุณุงุจูุงู)

---

## ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู `notifications`
```sql
CREATE TABLE notifications (
  id VARCHAR(255) PRIMARY KEY,
  user_id VARCHAR(255) NOT NULL,
  title VARCHAR(500) NOT NULL,
  message TEXT NOT NULL,
  type VARCHAR(50) NOT NULL, -- 'event_reminder', 'subscription_purchased', 'subscription_expired'
  read BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  data JSONB,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Indexes ููุฃุฏุงุก
CREATE INDEX idx_notifications_user_id ON notifications(user_id);
CREATE INDEX idx_notifications_read ON notifications(read);
CREATE INDEX idx_notifications_created_at ON notifications(created_at DESC);
```

---

## ุฃููุงุน ุงูุฅุดุนุงุฑุงุช

### 1. ุชุฐููุฑ ุจุญุฏุซ ุงูุชุตุงุฏู (`event_reminder`)
- **ูุชู**: ูุจู 5 ุฏูุงุฆู ูู ุตุฏูุฑ ุงูุฎุจุฑ
- **ูู ูุณุชูุจูู**: ุฌููุน ุงููุณุชุฎุฏููู ุงููุดุชุฑููู (ุงุดุชุฑุงู ูุดุท)
- **ุงููุญุชูู**: 
  - ุงูุนููุงู: `๐ด ุชุฐููุฑ: ุญุฏุซ ุงูุชุตุงุฏู ูุฑูุจ`
  - ุงูุฑุณุงูุฉ: `ุณูุตุฏุฑ ุฎุจุฑ "ุงุณู ุงูุฎุจุฑ" ุฎูุงู 5 ุฏูุงุฆู (ุงูููุช)`
- **ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ**: `{ eventName, eventTime, impact }`

### 2. ุชู ุดุฑุงุก ุงุดุชุฑุงู (`subscription_purchased`)
- **ูุชู**: ููุฑุงู ุนูุฏ ุดุฑุงุก ุจุงูุฉ ุจูุฌุงุญ
- **ูู ูุณุชูุจูู**: ุงููุณุชุฎุฏู ุงูุฐู ุงุดุชุฑู ุงูุจุงูุฉ
- **ุงููุญุชูู**:
  - ุงูุนููุงู: `๐ ุชู ุชูุนูู ุงูุงุดุชุฑุงู`
  - ุงูุฑุณุงูุฉ: `ุชู ุชูุนูู ุจุงูุฉ [ุงุณู ุงูุจุงูุฉ] ููุฏุฉ [ุงููุฏุฉ] ุจูุฌุงุญ`
- **ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ**: `{ packageName, duration }`

### 3. ุงูุชูุช ุตูุงุญูุฉ ุงูุงุดุชุฑุงู (`subscription_expired`)
- **ูุชู**: ุนูุฏ ุงูุชูุงุก ุงูุงุดุชุฑุงู (ูุญุต ูู ุณุงุนุฉ)
- **ูู ูุณุชูุจูู**: ุงููุณุชุฎุฏู ุงูุฐู ุงูุชูู ุงุดุชุฑุงูู
- **ุงููุญุชูู**:
  - ุงูุนููุงู: `โ๏ธ ุงูุชูุช ุตูุงุญูุฉ ุงุดุชุฑุงูู`
  - ุงูุฑุณุงูุฉ: `ุงูุชูุช ุตูุงุญูุฉ ุจุงูุฉ [ุงุณู ุงูุจุงูุฉ]. ูู ุจุชุฌุฏูุฏ ุงุดุชุฑุงูู ููุงุณุชูุฑุงุฑ ูู ุงูุงุณุชูุงุฏุฉ ูู ุงูุฎุฏูุงุช`
- **ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ**: `{ packageName }`

---

## ุงูููุงู ุงููุฌุฏููุฉ

### 1. ูุฑุงูุจุฉ ุงูุฃุญุฏุงุซ ุงูุงูุชุตุงุฏูุฉ
- **ุงูุชูุฑุงุฑ**: ูู ุฏูููุฉ
- **ุงููุธููุฉ**: ูุญุต ุงูุฃุญุฏุงุซ ุงููุงุฏูุฉ ุฎูุงู 5-6 ุฏูุงุฆู ูุฅุฑุณุงู ุชุฐููุฑุงุช
- **ุงูุฎุฏูุฉ**: `startEconomicEventReminders()`

### 2. ูุญุต ุงูุงุดุชุฑุงูุงุช ุงูููุชููุฉ
- **ุงูุชูุฑุงุฑ**: ูู ุณุงุนุฉ
- **ุงููุธููุฉ**: ูุญุต ุงูุงุดุชุฑุงูุงุช ุงูุชู ุงูุชูุช ุฎูุงู ุงูุณุงุนุฉ ุงููุงุถูุฉ ูุฅุฑุณุงู ุฅุดุนุงุฑุงุช
- **ุงูุฎุฏูุฉ**: `startSubscriptionExpiryCheck()`

### 3. ุชูุธูู ุงูุฅุดุนุงุฑุงุช ุงููุฏููุฉ
- **ุงูุชูุฑุงุฑ**: ููููุงู ูู ุงูุณุงุนุฉ 3 ุตุจุงุญุงู
- **ุงููุธููุฉ**: ุญุฐู ุงูุฅุดุนุงุฑุงุช ุงูุฃูุฏู ูู 30 ููู
- **ุงูุฎุฏูุฉ**: `startNotificationCleanup()`

---

## ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช ูู ุงูุฎุงุฏู:

1. **ุงุฎุชุจุงุฑ ุชุฐููุฑ ุญุฏุซ ุงูุชุตุงุฏู**:
```javascript
// ูู server console ุฃู endpoint
const { createEventReminderNotification } = require('./services/notificationService');
await createEventReminderNotification(
  'user_id_here',
  'Non-Farm Payrolls',
  '15:30',
  'high'
);
```

2. **ุงุฎุชุจุงุฑ ุดุฑุงุก ุงุดุชุฑุงู**:
```bash
# ุดุฑุงุก ุจุงูุฉ ูู ุงูุชุทุจูู ุฃู API
POST /api/subscription/purchase
{
  "packageId": "weekly-basic"
}
```

3. **ุงุฎุชุจุงุฑ ุงูุชูุงุก ุงุดุชุฑุงู**:
```javascript
// ุชุนุฏูู subscription_expiry ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชููู ูู ุงููุงุถู
// ุซู ุงูุชุธุฑ ุงููุญุต ุงูุชููุงุฆู (ูู ุณุงุนุฉ) ุฃู ุงุณุชุฏุนุงุก ูุฏูู:
const { checkExpiredSubscriptions } = require('./services/scheduledNotifications');
await checkExpiredSubscriptions();
```

### ุงุฎุชุจุงุฑ ูู ุงูุชุทุจูู:

1. ุงูุชุญ ุงูุชุทุจูู ูุณุฌู ุฏุฎูู
2. ุงุถุบุท ุนูู ุฃููููุฉ ุงูุฅุดุนุงุฑุงุช ูู ุงูููุฏุฑ
3. ูุฌุจ ุฃู ุชุธูุฑ ุดุงุดุฉ ุงูุฅุดุนุงุฑุงุช
4. ุงุฎุชุจุฑ:
   - Pull-to-refresh
   - ุงูุถุบุท ุนูู ุฅุดุนุงุฑ (ูุชุญูู ุฅูู ููุฑูุก)
   - ุฒุฑ "ุชุนููู ุงููู ูููุฑูุก"
   - ุฒุฑ ุงูุญุฐู

---

## ุงููููุงุช ุงููุนุฏูุฉ/ุงูููุดุฃุฉ

### ุงูุฎุงุฏู:
- โ `server/src/services/notificationService.ts` (ุฌุฏูุฏ)
- โ `server/src/services/scheduledNotifications.ts` (ุฌุฏูุฏ)
- โ `server/src/routes/notifications.ts` (ุฌุฏูุฏ)
- โ `server/src/index.ts` (ูุนุฏู)
- โ `server/src/routes/subscription.ts` (ูุนุฏู)

### ุงูุชุทุจูู:
- โ `mobile/src/screens/NotificationsScreen.tsx` (ุฌุฏูุฏ)
- โ `mobile/src/services/apiService.ts` (ูุนุฏู)
- โ `mobile/src/components/Header.tsx` (ูุนุฏู ุณุงุจูุงู)
- โ `mobile/src/screens/HomeScreen.tsx` (ูุนุฏู)
- โ `mobile/src/navigation/AppNavigator.tsx` (ูุนุฏู ุณุงุจูุงู)

---

## ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

1. **Push Notifications**: ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช push ุนูุฏ ุฅูุดุงุก ุฅุดุนุงุฑ ุฌุฏูุฏ
2. **ุฃุตูุงุช ุงูุฅุดุนุงุฑุงุช**: ุฅุถุงูุฉ ุฃุตูุงุช ูุฎุชููุฉ ููู ููุน
3. **ุฅุดุนุงุฑุงุช ุฅุถุงููุฉ**: 
   - ุชุญููู ุฌุฏูุฏ ูุชุงุญ
   - ุตููุฉ ุฌุฏูุฏุฉ
   - ุชุญุฏูุซ ูู ุงูุณุนุฑ
4. **ููุชุฑุฉ ุงูุฅุดุนุงุฑุงุช**: ุงูุณูุงุญ ูููุณุชุฎุฏู ุจููุชุฑุฉ ุญุณุจ ุงูููุน
5. **ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช**: ุงูุณูุงุญ ูููุณุชุฎุฏู ุจุชูุนูู/ุชุนุทูู ุฃููุงุน ูุนููุฉ

---

## ููุงุญุธุงุช ูููุฉ

1. **ุงูุฃุฏุงุก**: ุชู ุฅูุดุงุก indexes ุนูู ุงูุฌุฏูู ูุชุญุณูู ุงูุฃุฏุงุก
2. **ุงูุชูุธูู ุงูุชููุงุฆู**: ุงูุฅุดุนุงุฑุงุช ุงููุฏููุฉ (>30 ููู) ุชูุญุฐู ุชููุงุฆูุงู
3. **ุชุฌูุจ ุงูุชูุฑุงุฑ**: ูุธุงู ุชุฐููุฑ ุงูุฃุญุฏุงุซ ูุชุฌูุจ ุฅุฑุณุงู ููุณ ุงูุฅุดุนุงุฑ ูุฑุชูู
4. **ุงูุฃูุงู**: ุฌููุน endpoints ูุญููุฉ ุจู `authMiddleware`
5. **RTL Support**: ุงูุชุตููู ูุฏุนู ุงููุบุฉ ุงูุนุฑุจูุฉ ุจุดูู ูุงูู

---

## ุงูุญุงูุฉ ุงูููุงุฆูุฉ
โ **ูุธุงู ุงูุฅุดุนุงุฑุงุช ููุชูู ูุฌุงูุฒ ููุงุณุชุฎุฏุงู**

ุฌููุน ุงููุชุทูุจุงุช ุชู ุชูููุฐูุง:
- โ ุชุฐููุฑ ุจุงูุฃุญุฏุงุซ ุงูุงูุชุตุงุฏูุฉ (ูุจู 5 ุฏูุงุฆู)
- โ ุฅุดุนุงุฑ ุดุฑุงุก ุงุดุชุฑุงู
- โ ุฅุดุนุงุฑ ุงูุชูุงุก ุงุดุชุฑุงู
- โ ุดุงุดุฉ ุฅุดุนุงุฑุงุช ูุงููุฉ ูู ุงูุชุทุจูู
- โ Badge ูู ุงูููุฏุฑ ูุนุฑุถ ุงูุนุฏุฏ
- โ API ูุงูู ููุฅุฏุงุฑุฉ
- โ ููุงู ูุฌุฏููุฉ ุชููุงุฆูุฉ
