# ุฅุตูุงุญ ุชุญุฏูุซ ุงูุนููุงุช ูู ุงูุฎุงุฏู โ

## ุงููุดููุฉ
ูุงู ุงูุชุทุจูู ูุง ูููู ุจุชุญุฏูุซ ุฑุตูุฏ ุงูุนููุงุช ูู ุงูุฎุงุฏู ุจุดูู ุตุญูุญ ุจุนุฏ ุนูููุงุช ุงููุญุงุฏุซุฉ ูุงููุชุงุจุนุฉ.

## ุงูุฃุณุจุงุจ ุงูููุชุดูุฉ

### 1. ุงุณุชุฏุนุงุก ุฏุงูุฉ ูุญุฐููุฉ ูู `runAlgo`
- ูุงู ููุงู ุงุณุชุฏุนุงุก ูุฏุงูุฉ `updateCoinsAfterOperation(50)` ุงูุชู ุชู ุญุฐููุง
- ูุฐุง ูุงู ูุณุจุจ ุฎุทุฃ ูู ุงูุชูููุฐ ููููุน ุชุญุฏูุซ ุงูุจูุงูุงุช

### 2. ููุต ุงุณุชูุฑุงุฏ ูู Middleware
- ูุงู `chatPermissionMiddleware` ูุณุชุฎุฏู `getUserById` ุจุฏูู ุงุณุชูุฑุงุฏู
- ุชู ุฅุถุงูุฉ ุงูุงุณุชูุฑุงุฏ ุงูููููุฏ

## ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ

### 1. ุฅุตูุงุญ `server/src/middleware/subscriptionAuth.ts`
```typescript
// ุฅุถุงูุฉ ุงุณุชูุฑุงุฏ getUserById
import { deductCoins, getUserById } from '../db/database';
```

### 2. ุฅุตูุงุญ `mobile/src/screens/DashboardScreen.tsx`
```typescript
// ุฅุฒุงูุฉ ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ ุงููุญุฐููุฉ
// ูุจู:
if (!hasActiveSubscription) {
  await updateCoinsAfterOperation(50);
}
await fetchUserData();

// ุจุนุฏ:
await fetchUserData(); // ูุฌูุจ ุงูุนููุงุช ุงููุญุฏุซุฉ ูู ุงูุฎุงุฏู
```

## ููู ูุนูู ุงููุธุงู ุงูุขู

### ูููุญุงุฏุซุฉ ูุงููุชุงุจุนุฉ:
1. **ุงูุฎุงุฏู ูุฎุตู ุงูุนููุงุช** ูู `chatPermissionMiddleware`
2. **ุงูุฎุงุฏู ูุฑุฌุน `updatedCoins`** ูู ุงูุงุณุชุฌุงุจุฉ
3. **ุงูุชุทุจูู ูุญุฏุซ ุงูุนููุงุช ููุฑุงู**: `setCoins(chatResponse.updatedCoins)`
4. **ุงูุชุทุจูู ูุฌูุจ ุจูุงูุงุช ุงููุณุชุฎุฏู**: `fetchUserData()` ููุชุฃูุฏ

### ุนูุฏ ูุชุญ ุงูุชุทุจูู:
1. ุงูุนููุงุช ุชุจุฏุฃ ูู `0` (ูุง ุชูุฌุฏ ูููุฉ ุงูุชุฑุงุถูุฉ ูุญููุฉ)
2. `fetchUserData()` ูุชู ุงุณุชุฏุนุงุคู ุชููุงุฆูุงู
3. ุงูุนููุงุช ูุชู ุฌูุจูุง ูู `/api/auth/me`
4. ุงูุชุทุจูู ูุญุฏุซ ูู ุฏูููุฉ ุชููุงุฆูุงู

### ูููุดุชุฑููู:
- ุงููุญุงุฏุซุฉ ูุงููุชุงุจุนุฉ **ูุฌุงููุฉ** (ูุง ุฎุตู)
- `updatedCoins` ูุชู ุฅุฑุฌุงุนู ุฏุงุฆูุงู ููุชุฃูุฏ ูู ุงูุชุฒุงูู

## ุงููููุงุช ุงููุนุฏูุฉ
1. `server/src/middleware/subscriptionAuth.ts` - ุฅุถุงูุฉ ุงุณุชูุฑุงุฏ `getUserById`
2. `mobile/src/screens/DashboardScreen.tsx` - ุฅุฒุงูุฉ ุงุณุชุฏุนุงุก ุฏุงูุฉ ูุญุฐููุฉ

## ุงูุชุญูู ูู ุงูุฅุตูุงุญ
โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู TypeScript
โ ุฌููุน ุงูุงุณุชูุฑุงุฏุงุช ููุฌูุฏุฉ
โ ุงูุนููุงุช ูุชู ุฌูุจูุง ูู ุงูุฎุงุฏู ููุท
โ ูุง ุชูุฌุฏ ููู ุงูุชุฑุงุถูุฉ ูุญููุฉ
โ ุงูุชุญุฏูุซ ูุญุฏุซ ุจุนุฏ ูู ุนูููุฉ

## ููุงุญุธุงุช ูููุฉ
- **ูู ุงูุชุญูู ูู ุงูุฎุงุฏู**: ูุง ูููู ุงูุชูุงุนุจ ุจุงูุนููุงุช ูู ุงูุชุทุจูู
- **ูุง ุชูุฌุฏ ุจูุงูุงุช ูุญููุฉ**: ุงูุนููุงุช ุฏุงุฆูุงู ูู ุงูุฎุงุฏู
- **ุชุญุฏูุซ ููุฑู**: ุจุนุฏ ูู ูุญุงุฏุซุฉ ุฃู ูุชุงุจุนุฉ
- **ุชุญุฏูุซ ุฏูุฑู**: ูู ุฏูููุฉ ุชููุงุฆูุงู

## ุงูุฎุทูุงุช ุงูุชุงููุฉ ููุงุฎุชุจุงุฑ
1. ุดุบู ุงูุฎุงุฏู: `cd server && npm run dev`
2. ุดุบู ุงูุชุทุจูู: `cd mobile && npm start`
3. ุณุฌู ุฏุฎูู ุจุญุณุงุจ ูุฌุงูู
4. ุชุญูู ูู ุฑุตูุฏ ุงูุนููุงุช ุนูุฏ ุงููุชุญ
5. ุฃุฑุณู ุฑุณุงูุฉ ูุญุงุฏุซุฉ
6. ุชุญูู ูู ุชุญุฏูุซ ุงูุนููุงุช ููุฑุงู (-50)
7. ูู ุจูุชุงุจุนุฉ ุตููุฉ
8. ุชุญูู ูู ุชุญุฏูุซ ุงูุนููุงุช ููุฑุงู (-50)

ุชู ุงูุฅุตูุงุญ ุจูุฌุงุญ! ๐
