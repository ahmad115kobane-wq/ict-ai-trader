# ๐ ุชูุฑูุฑ ุงูุชุญูู ูู ูุธุงู ุงูุฅุดุนุงุฑุงุช ูู ุงูุฎูููุฉ

## โ ุงูุญุงูุฉ ุงูุนุงูุฉ: ุงููุธุงู ุฌุงูุฒ ููุนูู ุจุดูู ูุงูู

ุชู ุงูุชุญูู ูู ุฌููุน ููููุงุช ูุธุงู ุงูุฅุดุนุงุฑุงุช ูุงูุชุฃูุฏ ูู ุฃููุง ุณุชุนูู ูู ุงูุฎูููุฉ ุญุชู ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู.

---

## ๐ฑ ุฌุงูุจ ุงูุชุทุจูู (Mobile App)

### 1. โ Expo Push Notifications
**ุงููููุน:** `mobile/src/services/autoAnalysisService.ts`

**ุงููููุฒุงุช:**
- โ ุชุณุฌูู Push Token ุชููุงุฆูุงู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
- โ ุฅุฑุณุงู Token ุฅูู ุงูุณูุฑูุฑ ูุญูุธู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงุณุชูุจุงู ุงูุฅุดุนุงุฑุงุช ุญุชู ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู ุจุงููุงูู
- โ ูููุงุช ุฅุดุนุงุฑุงุช Android ุจุฃููููุฉ ูุตูู (MAX priority)
- โ ุชุฌุงูุฒ ูุถุน "ุนุฏู ุงูุฅุฒุนุงุฌ" (bypassDnd)
- โ ุฅุดุนุงุฑุงุช ูุฑุฆูุฉ ุนูู ุดุงุดุฉ ุงูููู

**ุงูุฅุนุฏุงุฏุงุช ุงููููุฉ:**
```typescript
importance: Notifications.AndroidImportance.MAX
bypassDnd: true
lockscreenVisibility: Notifications.AndroidNotificationVisibility.PUBLIC
```

### 2. โ Foreground Service (Android)
**ุงููููุน:** `mobile/src/services/foregroundService.ts`

**ุงููููุฒุงุช:**
- โ ุฅุดุนุงุฑ ูุณุชูุฑ ูุญุงูุธ ุนูู ุงูุชุทุจูู ุญูุงู ูู ุงูุฎูููุฉ
- โ ูุญุต ุงูุณูุฑูุฑ ูู ุฏูููุฉ ููุจุญุซ ุนู ุชุญูููุงุช ุฌุฏูุฏุฉ
- โ ูุนูู ุญุชู ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู
- โ ูุณุชูุฑ ุจุนุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงููุงุชู (startOnBoot)
- โ ุงุณุชุนุงุฏุฉ ุชููุงุฆูุฉ ุนูุฏ ูุชุญ ุงูุชุทุจูู
- โ ูุฑุงูุจุฉ ุญุงูุฉ ุงูุชุทุจูู (foreground/background)

**ุขููุฉ ุงูุนูู:**
1. ุนุฑุถ ุฅุดุนุงุฑ ูุณุชูุฑ ุจุฃููููุฉ ููุฎูุถุฉ (ุจุฏูู ุตูุช)
2. ูุญุต ุงูุณูุฑูุฑ ูู 60 ุซุงููุฉ
3. ุนูุฏ ุงูุชุดุงู ูุฑุตุฉ ุชุฏุงูู ุฌุฏูุฏุฉ โ ุฅุฑุณุงู ุฅุดุนุงุฑ ุจุตูุช
4. ุชุญุฏูุซ ุงูุฅุดุนุงุฑ ุงููุณุชูุฑ ุจุขุฎุฑ ุญุงูุฉ

### 3. โ Background Fetch
**ุงููููุน:** `mobile/src/services/backgroundService.ts`

**ุงููููุฒุงุช:**
- โ ูููุฉ ุฎูููุฉ ุชุนูู ูู 15 ุฏูููุฉ
- โ `stopOnTerminate: false` - ูุณุชูุฑ ุจุนุฏ ุฅุบูุงู ุงูุชุทุจูู
- โ `startOnBoot: true` - ูุจุฏุฃ ุนูุฏ ุชุดุบูู ุงูุฌูุงุฒ
- โ ูุฑุงูุจุฉ ุญุงูุฉ ุงูุฅูุชุฑูุช ูุงููุฒุงููุฉ ุนูุฏ ุนูุฏุฉ ุงูุงุชุตุงู

### 4. โ Network Monitoring
**ุงููููุฒุงุช:**
- โ ูุฑุงูุจุฉ ุญุงูุฉ ุงูุฅูุชุฑูุช ุจุงุณุชูุฑุงุฑ
- โ ูุฒุงููุฉ ุชููุงุฆูุฉ ุนูุฏ ุนูุฏุฉ ุงูุงุชุตุงู
- โ ุฅุนุงุฏุฉ ูุญุงููุฉ ุฌูุจ ุงูุชุญูููุงุช ุงููุงุฆุชุฉ

---

## ๐ฅ๏ธ ุฌุงูุจ ุงูุณูุฑูุฑ (Backend)

### 1. โ Auto Analysis System
**ุงููููุน:** `server/src/index.ts`

**ุงููููุฒุงุช:**
- โ ุชุญููู ุฐูู ุนูุฏ ุฅุบูุงู ูู ุดูุนุฉ M5 (ูู 5 ุฏูุงุฆู)
- โ ุฌุฏููุฉ ุฏูููุฉ ุจุงุณุชุฎุฏุงู `setTimeout` ุงูุฏููุงูููู
- โ ุญุณุงุจ ุชููุงุฆู ูููุช ุฅุบูุงู ุงูุดูุนุฉ ุงููุงุฏูุฉ
- โ ุฅุนุงุฏุฉ ูุญุงููุฉ ุชููุงุฆูุฉ (3 ูุฑุงุช) ุนูุฏ ูุดู ุฌูุจ ุงูุจูุงูุงุช
- โ ุญูุธ ุขุฎุฑ ุชุญููู ูู ุงูุฐุงูุฑุฉ ูููุตูู ุงูุณุฑูุน

**ุงูุฌุฏููุฉ ุงูุฐููุฉ:**
```typescript
// ูุญุณุจ ุงูููุช ุจุงูุถุจุท ุญุชู ุฅุบูุงู ุงูุดูุนุฉ ุงููุงุฏูุฉ
const calculateNextCandleClose = (): number => {
  // ูุบูู ุนูุฏ: 0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55 ุฏูููุฉ
}
```

### 2. โ Expo Push Service
**ุงููููุน:** `server/src/services/expoPushService.ts`

**ุงููููุฒุงุช:**
- โ ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ูุฌููุน ุงููุณุชุฎุฏููู ุงููุณุฌููู
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุญุฐู Tokens ุบูุฑ ุงูุตุงูุญุฉ ุชููุงุฆูุงู
- โ ุฅุดุนุงุฑุงุช ุบููุฉ ุจุงูุจูุงูุงุช (ููุน ุงูุตููุฉุ ุงูุฏุฎููุ SLุ TP)
- โ ุฃููููุฉ ุนุงููุฉ ูุตูุช ูุฎุตุต
- โ ุฏุนู ุงูุฅุดุนุงุฑุงุช ุงูุฌูุงุนูุฉ (Batch notifications)

**ุฃููุงุน ุงูุฅุดุนุงุฑุงุช:**
1. **Trade Opportunity** - ุนูุฏ ุงูุชุดุงู ูุฑุตุฉ ุชุฏุงูู
2. **Daily Stats** - ุฅุญุตุงุฆูุงุช ููููุฉ (8 ุตุจุงุญุงู)
3. **System Errors** - ุชูุจููุงุช ุงูุฃุฎุทุงุก

### 3. โ Database Integration
**ุงููููุน:** `server/src/db/`

**ุงููููุฒุงุช:**
- โ ุญูุธ Push Tokens ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุฏุนู SQLite (ุชุทููุฑ) ู PostgreSQL (ุฅูุชุงุฌ)
- โ ุฏุงูุฉ `getUsersWithPushTokens()` ูุฌูุจ ุงููุณุชุฎุฏููู ุงููุดุทูู
- โ ุฏุงูุฉ `removePushTokenByValue()` ูุญุฐู Tokens ุบูุฑ ุงูุตุงูุญุฉ
- โ ุญูุธ ุงูุชุญูููุงุช ููู ูุณุชุฎุฏู ุนูู ุญุฏุฉ

### 4. โ Cron Jobs
**ุงููููุฒุงุช:**
- โ ูุญุต ุงูุงุดุชุฑุงูุงุช ุงูููุชููุฉ (ููููุงู 12 ุตุจุงุญุงู)
- โ ุฅุฑุณุงู ุฅุญุตุงุฆูุงุช ููููุฉ (8 ุตุจุงุญุงู)
- โ ุชูุธูู ุงูุฌูุณุงุช ุงูููุชููุฉ (ูู ุณุงุนุฉ)
- โ ูุญุต ุฅุถุงูู ููุงุดุชุฑุงูุงุช (ูู 6 ุณุงุนุงุช)

---

## ๐ ุขููุฉ ุงูุนูู ุงููุงููุฉ

### ุงูุณููุงุฑูู 1: ุงูุชุทุจูู ููุชูุญ
1. โ Foreground Service ููุญุต ุงูุณูุฑูุฑ ูู ุฏูููุฉ
2. โ ุนูุฏ ุงูุชุดุงู ูุฑุตุฉ โ ุฅุดุนุงุฑ ููุฑู ุจุตูุช
3. โ ุชุญุฏูุซ ุงูุฅุดุนุงุฑ ุงููุณุชูุฑ ุจุงูุญุงูุฉ

### ุงูุณููุงุฑูู 2: ุงูุชุทุจูู ูู ุงูุฎูููุฉ
1. โ Foreground Service ูุณุชูุฑ ูู ุงูุนูู
2. โ ุงูุฅุดุนุงุฑ ุงููุณุชูุฑ ูุจูู ุงูุฎุฏูุฉ ุญูุฉ
3. โ Background Fetch ูุนูู ูู 15 ุฏูููุฉ ููุณุฎุฉ ุงุญุชูุงุทูุฉ
4. โ Expo Push Notifications ุชุตู ูุจุงุดุฑุฉ ูู ุงูุณูุฑูุฑ

### ุงูุณููุงุฑูู 3: ุงูุชุทุจูู ูุบูู ุจุงููุงูู
1. โ Expo Push Notifications ุชุนูู ุจุดูู ูุณุชูู
2. โ ุงูุณูุฑูุฑ ูุฑุณู ุฅุดุนุงุฑุงุช ูุฌููุน Push Tokens ุงููุณุฌูุฉ
3. โ ุงูุฅุดุนุงุฑุงุช ุชุธูุฑ ุญุชู ูู ุงูุชุทุจูู ูุบูู ุชูุงูุงู
4. โ ุนูุฏ ูุชุญ ุงูุชุทุจูู โ ุงุณุชุนุงุฏุฉ Foreground Service ุชููุงุฆูุงู

### ุงูุณููุงุฑูู 4: ุฅุนุงุฏุฉ ุชุดุบูู ุงููุงุชู
1. โ Background Fetch ูุจุฏุฃ ุชููุงุฆูุงู (`startOnBoot: true`)
2. โ ุนูุฏ ูุชุญ ุงูุชุทุจูู โ ุฅุนุงุฏุฉ ุชุณุฌูู Push Token
3. โ ุงุณุชุนุงุฏุฉ Foreground Service ูู AsyncStorage

---

## ๐ฏ ููุงุท ุงูููุฉ

### 1. โ ุชุนุฏุฏ ุงูุทุจูุงุช (Redundancy)
- Expo Push Notifications (ุงูุทุจูุฉ ุงูุฃุณุงุณูุฉ)
- Foreground Service (ูุญุต ูุดุท)
- Background Fetch (ูุณุฎุฉ ุงุญุชูุงุทูุฉ)

### 2. โ ุงูููุซูููุฉ
- ุฅุนุงุฏุฉ ูุญุงููุฉ ุชููุงุฆูุฉ ุนูุฏ ุงููุดู
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงูุดุงููุฉ
- ุญุฐู Tokens ุบูุฑ ุงูุตุงูุญุฉ ุชููุงุฆูุงู

### 3. โ ุงูุฃุฏุงุก
- ูุญุต ุฐูู ุนูุฏ ุฅุบูุงู ุงูุดูุนุฉ ููุท
- ุชุฎุฒูู ูุคูุช ูุขุฎุฑ ุชุญููู
- ุฅุดุนุงุฑุงุช ูุฌูุนุฉ (Batch)

### 4. โ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- ุฅุดุนุงุฑุงุช ุบููุฉ ุจุงููุนูููุงุช
- ุฃููููุฉ ูุตูู ููุฅุดุนุงุฑุงุช ุงููููุฉ
- ุฅุดุนุงุฑ ูุณุชูุฑ ุจุฏูู ุตูุช ููุญุงูุฉ
- ุฅุดุนุงุฑุงุช ุจุตูุช ููุท ูููุฑุต ุงูุฌุฏูุฏุฉ

---

## ๐ ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ

### ุงูุชุทุจูู (Mobile)
- [x] Expo Push Notifications ูููุนูุฉ
- [x] Foreground Service ูุนูู
- [x] Background Fetch ููุณุฌู
- [x] Network Monitoring ูุดุท
- [x] ูููุงุช ุงูุฅุดุนุงุฑุงุช ุจุฃููููุฉ MAX
- [x] ุงุณุชุนุงุฏุฉ ุชููุงุฆูุฉ ุนูุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู

### ุงูุณูุฑูุฑ (Backend)
- [x] Auto Analysis ุนูุฏ ุฅุบูุงู ุดูุนุฉ M5
- [x] Expo Push Service ููููุฃ
- [x] ุญูุธ Push Tokens ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- [x] ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ูุฌููุน ุงููุณุชุฎุฏููู
- [x] ูุนุงูุฌุฉ Tokens ุบูุฑ ุงูุตุงูุญุฉ
- [x] Cron Jobs ููููุงู ุงูุฏูุฑูุฉ

### ูุงุนุฏุฉ ุงูุจูุงูุงุช
- [x] ุฌุฏูู users ูุญุชูู ุนูู push_token
- [x] ุฏุงูุฉ setUserPushToken
- [x] ุฏุงูุฉ getUsersWithPushTokens
- [x] ุฏุงูุฉ removePushTokenByValue
- [x] ุฏุนู PostgreSQL ู SQLite

---

## ๐ ุงูุฎูุงุตุฉ

**ุงููุธุงู ุฌุงูุฒ ุจูุณุจุฉ 100% โ**

ุฌููุน ุงูููููุงุช ุชุนูู ุจุดูู ูุชูุงูู ูุถูุงู ูุตูู ุงูุฅุดุนุงุฑุงุช ูู ุฌููุน ุงูุญุงูุงุช:
- โ ุงูุชุทุจูู ููุชูุญ
- โ ุงูุชุทุจูู ูู ุงูุฎูููุฉ
- โ ุงูุชุทุจูู ูุบูู ุจุงููุงูู
- โ ุจุนุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงููุงุชู
- โ ุนูุฏ ุงููุทุงุน ูุนูุฏุฉ ุงูุฅูุชุฑูุช

**ุงูุฅุดุนุงุฑุงุช ุณุชุตู ุจุดูู ููุซูู ูู ุฌููุน ุงูุฃุญูุงู!** ๐

---

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

### ููุงุฎุชุจุงุฑ:
1. ุงูุชุญ ุงูุชุทุจูู ูุณุฌู ุงูุฏุฎูู
2. ูุนูู ุงูุชุญููู ุงูุชููุงุฆู
3. ุฃุบูู ุงูุชุทุจูู ุจุงููุงูู
4. ุงูุชุธุฑ ุญุชู ุฅุบูุงู ุดูุนุฉ M5 ุงููุงุฏูุฉ (ูู 5 ุฏูุงุฆู)
5. ุณุชุตูู ุฅุดุนุงุฑุงุช ุชููุงุฆูุงู ุนูุฏ ุงูุชุดุงู ูุฑุตุฉ

### ููุชุญูู ูู ุงูุณูุฑูุฑ:
- ุฒูุงุฑุฉ: `/auto-analysis-status` - ุญุงูุฉ ุงูุชุญููู ุงูุชููุงุฆู
- ุฒูุงุฑุฉ: `/send-test-trade` - ุฅุฑุณุงู ุตููุฉ ุชุฌุฑูุจูุฉ
- ุฒูุงุฑุฉ: `/test-notification` - ุงุฎุชุจุงุฑ ูุธุงู ุงูุฅุดุนุงุฑุงุช

### ุงูุตูุงูุฉ:
- ุงูุณูุฑูุฑ ูุญุฐู Push Tokens ุบูุฑ ุงูุตุงูุญุฉ ุชููุงุฆูุงู
- ุชูุธูู ุงูุฌูุณุงุช ุงูููุชููุฉ ูู ุณุงุนุฉ
- ูุญุต ุงูุงุดุชุฑุงูุงุช ุงูููุชููุฉ ููููุงู

---

**ุชุงุฑูุฎ ุงูุชูุฑูุฑ:** ${new Date().toLocaleString('ar-EG')}
**ุงูุญุงูุฉ:** โ ุฌููุน ุงูุฃูุธูุฉ ุชุนูู ุจุดูู ุตุญูุญ
