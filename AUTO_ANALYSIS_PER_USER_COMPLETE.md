# โ ูุธุงู ุงูุชุญููู ุงูุชููุงุฆู ููู ูุณุชุฎุฏู - ููุชูู

## ๐ ุงูููุฎุต
ุชู ุชุนุฏูู ูุธุงู ุงูุชุญููู ุงูุชููุงุฆู ููุญูุธ ุงูุณุฌูุงุช ููู ูุณุชุฎุฏู ุนูู ุญุฏุฉุ ุจุญูุซ ูุฑู ูู ูุณุชุฎุฏู ููุท ุงูุณุฌูุงุช ุงูุชู ุชู ุฅูุดุงุคูุง ุนูุฏูุง ูุงู ุงูุชุญููู ุงูุชููุงุฆู ููุนูุงู ูุฏูู.

## ๐ฏ ูุง ุชู ุฅูุฌุงุฒู

### 1. ุชุนุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
**ุงูููู**: `server/src/db/database.ts`

#### ุฅุถุงูุฉ ุญููู ุฌุฏูุฏุฉ ูุฌุฏูู users:
- `auto_analysis_enabled` (BOOLEAN): ุญุงูุฉ ุงูุชุญููู ุงูุชููุงุฆู ูููุณุชุฎุฏู
- `auto_analysis_enabled_at` (TEXT): ุชุงุฑูุฎ ุขุฎุฑ ุชูุนูู

#### ุฏูุงู ุฌุฏูุฏุฉ:
```typescript
// ุชูุนูู/ุฅููุงู ุงูุชุญููู ุงูุชููุงุฆู ูููุณุชุฎุฏู
setUserAutoAnalysis(userId: string, enabled: boolean): boolean

// ุงูุญุตูู ุนูู ุฌููุน ุงููุณุชุฎุฏููู ุงูุฐูู ูุฏููู ุงูุชุญููู ุงูุชููุงุฆู ููุนู
getUsersWithAutoAnalysisEnabled(): any[]
```

### 2. ุชุนุฏูู ุงูุชุญููู ุงูุชููุงุฆู ูู ุงูุฎุงุฏู
**ุงูููู**: `server/src/index.ts`

#### ุงูุชุบููุฑุงุช:
- ุนูุฏ ุชุดุบูู ุงูุชุญููู ุงูุชููุงุฆูุ ูุชู ุฌูุจ ูุงุฆูุฉ ุงููุณุชุฎุฏููู ุงูุฐูู ูุฏููู ุงูุชุญููู ููุนู
- ูุชู ุญูุธ ูุณุฎุฉ ูู ุงูุชุญููู ููู ูุณุชุฎุฏู ููุนู ุนูู ุญุฏุฉ
- ูู ูุณุชุฎุฏู ูุญุตู ุนูู `user_id` ุฎุงุต ุจู ูู ุงูุณุฌูุงุช

```typescript
// ุฌูุจ ุงููุณุชุฎุฏููู ุงูุฐูู ูุฏููู ุงูุชุญููู ุงูุชููุงุฆู ููุนู
const usersWithAutoAnalysis = getUsersWithAutoAnalysisEnabled();

// ุญูุธ ุงูุชุญููู ููู ูุณุชุฎุฏู
for (const user of usersWithAutoAnalysis) {
  saveEnhancedAnalysis(
    uuidv4(),
    user.id, // ุญูุธ ููู ูุณุชุฎุฏู ุนูู ุญุฏุฉ
    symbol,
    currentPrice,
    analysis,
    'auto'
  );
}
```

### 3. ุฅุถุงูุฉ ุงูุชุญูู ูู ุงูุงุดุชุฑุงู
**ุงูููู**: `server/src/routes/analysis.ts`

#### endpoint: `/api/analysis/toggle-auto`
- ูุจู ุชูุนูู ุงูุชุญููู ุงูุชููุงุฆูุ ูุชู ุงูุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ูุฏูู ุงุดุชุฑุงู ูุดุท
- ุฅุฐุง ูู ููู ูุฏูู ุงุดุชุฑุงูุ ูุชู ุฑูุถ ุงูุทูุจ ูุน ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ

```typescript
if (enabled) {
  const subscriptionCheck = getUserSubscriptionStatus(userId);
  
  if (!subscriptionCheck.hasActiveSubscription) {
    return res.status(403).json({
      error: 'SUBSCRIPTION_REQUIRED',
      message: 'ูุฌุจ ุฃู ูููู ูุฏูู ุงุดุชุฑุงู ูุดุท ูุชูุนูู ุงูุชุญููู ุงูุชููุงุฆู'
    });
  }
}
```

### 4. ุชุญุฏูุซ ุงูุชุทุจูู
**ุงูููู**: `mobile/src/screens/DashboardScreen.tsx`

#### ุงูุชุบููุฑุงุช:
- ุนูุฏ ูุญุงููุฉ ุชูุนูู ุงูุชุญููู ุงูุชููุงุฆูุ ูุชู ุฅุฑุณุงู ุงูุทูุจ ููุฎุงุฏู ุฃููุงู
- ุฅุฐุง ุฑูุถ ุงูุฎุงุฏู (ุจุณุจุจ ุนุฏู ูุฌูุฏ ุงุดุชุฑุงู)ุ ูุชู ุนุฑุถ ุฑุณุงูุฉ ูููุณุชุฎุฏู
- ูุชู ุชูุฌูู ุงููุณุชุฎุฏู ูุตูุญุฉ ุงูุงุดุชุฑุงูุงุช

```typescript
try {
  await toggleUserAutoAnalysis(newState);
  // ูุฌุญ ุงูุชูุนูู
} catch (error) {
  if (error.message.includes('SUBSCRIPTION_REQUIRED')) {
    alert('โ๏ธ ูุฌุจ ุฃู ูููู ูุฏูู ุงุดุชุฑุงู ูุดุท');
    setActiveTab(DashboardTab.SUBSCRIPTIONS);
  }
}
```

## ๐ ููู ูุนูู ุงููุธุงู ุงูุขูุ

### ุนูุฏ ุชูุนูู ุงูุชุญููู ุงูุชููุงุฆู:
1. **ุงููุณุชุฎุฏู ูุถุบุท ุนูู ููุชุงุญ ุงูุชูุนูู** ูู ุงูุชุทุจูู
2. **ุงูุชุทุจูู ูุฑุณู ุทูุจ ููุฎุงุฏู** `/api/analysis/toggle-auto`
3. **ุงูุฎุงุฏู ูุชุญูู ูู ุงูุงุดุชุฑุงู**:
   - โ ุฅุฐุง ูุงู ูุฏูู ุงุดุชุฑุงู ูุดุท โ ูุชู ุงูุชูุนูู
   - โ ุฅุฐุง ูู ููู ูุฏูู ุงุดุชุฑุงู โ ูุชู ุงูุฑูุถ
4. **ูุชู ุญูุธ ุงูุญุงูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**:
   - `auto_analysis_enabled = 1`
   - `auto_analysis_enabled_at = current_timestamp`

### ุนูุฏ ุชุดุบูู ุงูุชุญููู ุงูุชููุงุฆู (ูู 5 ุฏูุงุฆู):
1. **ุงูุฎุงุฏู ูุฌูุจ ูุงุฆูุฉ ุงููุณุชุฎุฏููู** ุงูุฐูู ูุฏููู `auto_analysis_enabled = 1`
2. **ูุชู ุชุดุบูู ุงูุชุญููู ูุฑุฉ ูุงุญุฏุฉ** (ูุชูููุฑ ุงูููุงุฑุฏ)
3. **ูุชู ุญูุธ ูุณุฎุฉ ูู ุงููุชูุฌุฉ ููู ูุณุชุฎุฏู**:
   ```sql
   INSERT INTO enhanced_analysis_history (
     id, user_id, symbol, decision, ...
   ) VALUES (
     'uuid-1', 'user-1-id', 'XAUUSD', 'PLACE_PENDING', ...
   ), (
     'uuid-2', 'user-2-id', 'XAUUSD', 'PLACE_PENDING', ...
   )
   ```

### ุนูุฏ ุฌูุจ ุงูุณุฌูุงุช:
1. **ุงููุณุชุฎุฏู ููุชุญ ุชุจููุจ ุงูุณุฌูุงุช**
2. **ุงูุชุทุจูู ูุทูุจ** `/api/analysis/enhanced-history`
3. **ุงูุฎุงุฏู ูุฑุฌุน ููุท ุงูุณุฌูุงุช** ุงูุชู `user_id = current_user_id`
4. **ุงููุณุชุฎุฏู ูุฑู ููุท ุณุฌูุงุชู ุงูุฎุงุตุฉ**

## โ ุงูููุงุฆุฏ

### 1. ุฎุตูุตูุฉ ุฃูุถู
- ูู ูุณุชุฎุฏู ูุฑู ุณุฌูุงุชู ููุท
- ูุง ูุฑู ุณุฌูุงุช ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู

### 2. ุฏูุฉ ุฃุนูู
- ุงูุณุฌูุงุช ุชุนูุณ ุงููุชุฑุงุช ุงูุชู ูุงู ูููุง ุงูุชุญููู ููุนูุงู
- ูุง ุชูุฌุฏ ุณุฌูุงุช ูู ูุชุฑุงุช ุนุฏู ุงูุชูุนูู

### 3. ุฃูุงู ูุญุณูู
- ุงูุชุญูู ูู ุงูุงุดุชุฑุงู ูุจู ุงูุชูุนูู
- ููุน ุงููุณุชุฎุฏููู ุงููุฌุงูููู ูู ุงุณุชุฎุฏุงู ุงูููุฒุฉ

### 4. ููุงุกุฉ ุฃูุถู
- ุงูุชุญููู ูุชู ูุฑุฉ ูุงุญุฏุฉ ููุท
- ูุชู ูุณุฎ ุงููุชูุฌุฉ ููู ูุณุชุฎุฏู (ุณุฑูุน ุฌุฏุงู)

## ๐ ูุซุงู ุนููู

### ุงูุณููุงุฑูู:
- **ุงููุณุชุฎุฏู A**: ูุนูู ุงูุชุญููู ุงูุชููุงุฆู ุงูุณุงุนุฉ 10:00 ุตุจุงุญุงู
- **ุงููุณุชุฎุฏู B**: ูุนูู ุงูุชุญููู ุงูุชููุงุฆู ุงูุณุงุนุฉ 11:00 ุตุจุงุญุงู
- **ุงููุณุชุฎุฏู C**: ูู ููุนูู ุงูุชุญููู ุงูุชููุงุฆู

### ุงููุชูุฌุฉ:
- **ุงูุณุงุนุฉ 10:05**: ุชุญููู ุชููุงุฆู โ ููุญูุธ ูููุณุชุฎุฏู A ููุท
- **ุงูุณุงุนุฉ 10:10**: ุชุญููู ุชููุงุฆู โ ููุญูุธ ูููุณุชุฎุฏู A ููุท
- **ุงูุณุงุนุฉ 11:05**: ุชุญููู ุชููุงุฆู โ ููุญูุธ ูููุณุชุฎุฏู A ู B
- **ุงููุณุชุฎุฏู C**: ูุง ูุฑู ุฃู ุณุฌูุงุช ุชููุงุฆูุฉ

## ๐ง ุงููููุงุช ุงููุนุฏูุฉ

1. **server/src/db/database.ts**
   - ุฅุถุงูุฉ ุญููู `auto_analysis_enabled` ู `auto_analysis_enabled_at`
   - ุฅุถุงูุฉ ุฏูุงู `setUserAutoAnalysis` ู `getUsersWithAutoAnalysisEnabled`

2. **server/src/index.ts**
   - ุชุนุฏูู `runAutoAnalysis` ูุญูุธ ุงูุชุญููู ููู ูุณุชุฎุฏู

3. **server/src/routes/analysis.ts**
   - ุฅุถุงูุฉ ุงูุชุญูู ูู ุงูุงุดุชุฑุงู ูู `/toggle-auto`

4. **mobile/src/screens/DashboardScreen.tsx**
   - ุชุญุฏูุซ `toggleAutoAnalysis` ููุชุนุงูู ูุน ุฃุฎุทุงุก ุงูุงุดุชุฑุงู

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

ุงูุขู:
- โ ูู ูุณุชุฎุฏู ูุฑู ุณุฌูุงุชู ุงูุฎุงุตุฉ ููุท
- โ ุงูุณุฌูุงุช ุชุธูุฑ ููุท ูููุชุฑุงุช ุงูุชู ูุงู ูููุง ุงูุชุญููู ููุนูุงู
- โ ุงูุชุญูู ูู ุงูุงุดุชุฑุงู ูุจู ุงูุชูุนูู
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู
- โ ุงููุธุงู ูุนูู ุจููุงุกุฉ ุนุงููุฉ

---

**ุชู ุงูุฅูุฌุงุฒ ุจูุฌุงุญ! ๐**
