<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø­ Push Token</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }
        .container {
            max-width: 600px;
            margin: 50px auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
            text-align: center;
        }
        .button {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            margin: 20px 0;
            transition: transform 0.2s;
        }
        .button:hover {
            transform: translateY(-2px);
        }
        .button.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .result {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }
        .result.show {
            display: block;
        }
        .result.success {
            background: #f0fdf4;
            border: 2px solid #10b981;
        }
        .result.error {
            background: #fef2f2;
            border: 2px solid #ef4444;
        }
        .info {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 10px;
            border-right: 4px solid #3b82f6;
            margin: 20px 0;
        }
        code {
            background: #1f2937;
            color: #10b981;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—‘ï¸ Ù…Ø³Ø­ Push Tokens Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</h1>
        
        <div class="info">
            <p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong></p>
            <p>Push Tokens Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù€ Firebase Project Ù…Ø­Ø°ÙˆÙ</p>
            <br>
            <p><strong>Ø§Ù„Ø­Ù„:</strong></p>
            <p>Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Tokens Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p>
        </div>

        <button class="button" onclick="clearAllTokens()">
            ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Push Tokens
        </button>

        <button class="button success" onclick="checkTokens()">
            ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Tokens Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        </button>

        <div id="result" class="result"></div>

        <div class="info" style="margin-top: 30px;">
            <p><strong>Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø³Ø­:</strong></p>
            <ol style="margin-right: 20px; margin-top: 10px;">
                <li>Ø§ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</li>
                <li>Ø³Ø¬Ù„ Ø®Ø±ÙˆØ¬ (Logout)</li>
                <li>Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</li>
                <li>Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Push Token Ø¬Ø¯ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</li>
            </ol>
        </div>
    </div>

    <script>
        const API_URL = 'https://ict-ai-trader-production.up.railway.app/api/auth';

        async function clearAllTokens() {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result show';
            resultDiv.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø³Ø­...';

            try {
                const response = await fetch(`${API_URL}/clear-all-push-tokens`, {
                    method: 'POST'
                });
                const data = await response.json();

                if (data.success) {
                    resultDiv.className = 'result show success';
                    resultDiv.innerHTML = `
                        <h3>âœ… ØªÙ… Ø§Ù„Ù…Ø³Ø­ Ø¨Ù†Ø¬Ø§Ø­!</h3>
                        <p>ØªÙ… Ù…Ø³Ø­ ${data.clearedCount} push token</p>
                        <p style="margin-top: 10px;">Ø§Ù„Ø¢Ù† Ø§ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>
                    `;
                } else {
                    throw new Error(data.error || 'ÙØ´Ù„ Ø§Ù„Ù…Ø³Ø­');
                }
            } catch (error) {
                resultDiv.className = 'result show error';
                resultDiv.innerHTML = `
                    <h3>âŒ Ø®Ø·Ø£</h3>
                    <p>${error.message}</p>
                `;
            }
        }

        async function checkTokens() {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result show';
            resultDiv.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';

            try {
                const response = await fetch(`${API_URL}/list-push-tokens`);
                const data = await response.json();

                if (data.success) {
                    resultDiv.className = 'result show';
                    resultDiv.innerHTML = `
                        <h3>ğŸ“Š Push Tokens Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
                        <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:</strong> ${data.totalUsers}</p>
                        <p><strong>Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù„Ø¯ÙŠÙ‡Ù… Tokens:</strong> ${data.usersWithTokens}</p>
                        ${data.tokens.length > 0 ? `
                            <div style="margin-top: 15px;">
                                <strong>Ø§Ù„ØªÙØ§ØµÙŠÙ„:</strong>
                                ${data.tokens.map(t => `
                                    <div style="background: white; padding: 10px; margin: 10px 0; border-radius: 5px;">
                                        <p><strong>Email:</strong> ${t.email}</p>
                                        <p><strong>Token:</strong> <code>${t.pushToken.substring(0, 40)}...</code></p>
                                        <p><strong>Auto Analysis:</strong> ${t.autoAnalysisEnabled ? 'âœ…' : 'âŒ'}</p>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '<p style="margin-top: 10px;">âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ tokens Ù…Ø³Ø¬Ù„Ø©</p>'}
                    `;
                } else {
                    throw new Error(data.error || 'ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚');
                }
            } catch (error) {
                resultDiv.className = 'result show error';
                resultDiv.innerHTML = `
                    <h3>âŒ Ø®Ø·Ø£</h3>
                    <p>${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html>
