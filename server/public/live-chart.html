<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø­ÙŠ - XAUUSD</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0d1117 0%, #1a1a2e 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid rgba(0,200,150,0.3);
        }
        .header h1 {
            color: #00C896;
            font-size: 28px;
            margin-bottom: 10px;
        }
        .price-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .price-box {
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .price-label {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
            margin-bottom: 5px;
        }
        .price-value {
            font-size: 24px;
            font-weight: bold;
            color: #00C896;
        }
        .chart-container {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .tradingview-widget-container {
            flex: 1;
            min-height: 500px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.1);
        }
        .footer {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            text-align: center;
            border-top: 2px solid rgba(0,200,150,0.3);
            font-size: 14px;
            color: rgba(255,255,255,0.6);
        }
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: rgba(255,255,255,0.6);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“Š Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø­ÙŠ - XAUUSD</h1>
        <div class="price-info">
            <div class="price-box">
                <div class="price-label">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                <div class="price-value" id="currentPrice">--</div>
            </div>
            <div class="price-box">
                <div class="price-label">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</div>
                <div class="price-value" id="lastUpdate" style="font-size: 16px;">--</div>
            </div>
        </div>
    </div>

    <div class="chart-container">
        <!-- TradingView Widget BEGIN -->
        <div class="tradingview-widget-container">
            <div id="tradingview_chart"></div>
        </div>
        <!-- TradingView Widget END -->
    </div>

    <div class="footer">
        ğŸ¤– ICT AI Trader - ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
    </div>

    <!-- TradingView Widget Script -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script type="text/javascript">
        // ØªÙ‡ÙŠØ¦Ø© Telegram Web App
        let tg = window.Telegram.WebApp;
        tg.expand(); // ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ù†Ø§ÙØ°Ø© Ù„Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
        tg.ready();

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
        new TradingView.widget({
            "width": "100%",
            "height": "100%",
            "symbol": "OANDA:XAUUSD",
            "interval": "5",
            "timezone": "Asia/Riyadh",
            "theme": "dark",
            "style": "1",
            "locale": "ar_AE",
            "toolbar_bg": "#0d1117",
            "enable_publishing": false,
            "hide_side_toolbar": false,
            "allow_symbol_change": false,
            "save_image": false,
            "container_id": "tradingview_chart",
            "studies": [
                "MASimple@tv-basicstudies"
            ],
            "show_popup_button": true,
            "popup_width": "1000",
            "popup_height": "650"
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
        async function updatePrice() {
            try {
                const response = await fetch('/api/analysis/current-price?symbol=XAUUSD');
                const data = await response.json();
                
                if (data.price) {
                    document.getElementById('currentPrice').textContent = data.price.toFixed(2);
                    document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('ar-SA');
                }
            } catch (error) {
                console.error('Error fetching price:', error);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
        updatePrice();
        setInterval(updatePrice, 10000);
    </script>
</body>
</html>
